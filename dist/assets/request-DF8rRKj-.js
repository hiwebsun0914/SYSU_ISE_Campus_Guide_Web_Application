const w="/api";function b(o={}){const s=new URLSearchParams;Object.entries(o).forEach(([r,a])=>{a!=null&&s.append(r,a)});const e=s.toString();return e?`?${e}`:""}function y(o,s){return/^https?:\/\//i.test(s)||s.startsWith("//")?s:`${String(o||"").replace(/\/+$/,"")}/${String(s).replace(/^\/+/,"")}`}async function R(o,s,{timeout:e,responseType:r,rawResponse:a}={}){const i=new AbortController,u=setTimeout(()=>i.abort(new Error("TIMEOUT")),e);s.signal=i.signal;let t;try{t=await fetch(o,s)}finally{clearTimeout(u)}if(a||r==="response")return t;const f=(t.headers.get("content-type")||"").toLowerCase();let n;try{if(r==="blob")n=await t.blob();else if(r==="text")n=await t.text();else if(f.includes("application/json"))n=await t.json();else if(t.status===204)n={};else{let c=await t.text();try{n=JSON.parse(c)}catch{n=c}}}catch{n=null}return{ok:t.ok,status:t.status,statusCode:t.status,data:n,raw:n,headers:t.headers}}async function g(o,s="GET",e=null,r={}){const{headers:a,timeout:i=1e4,credentials:u="include",cacheBust:t=!1,responseType:f,base:n=w,retry:c=0,rawResponse:E=!1}=r,h=localStorage.getItem("token")||"",p={Accept:"application/json, text/plain, */*","X-Requested-With":"XMLHttpRequest",...a||{}},l={method:String(s||"GET").toUpperCase(),headers:p,credentials:u};l.method==="GET"?(e&&(o+=b(e)),t&&(o+=(o.includes("?")?"&":"?")+`_=${Date.now()}`)):e!=null&&!(e instanceof FormData)?(p["Content-Type"]="application/json",l.body=JSON.stringify(e)):e instanceof FormData&&(l.body=e),h&&(p.Authorization=`Bearer ${h}`);const m=y(n,o);let d=0;for(;;){d++;try{return await R(m,l,{timeout:i,responseType:f,rawResponse:E})}catch(T){if(d>c)return{ok:!1,status:0,statusCode:0,data:{code:-1,message:"NETWORK_ERROR",error:String(T)}}}}}export{g as r};
