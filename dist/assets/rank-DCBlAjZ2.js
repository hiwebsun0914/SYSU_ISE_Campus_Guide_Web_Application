import{r as A}from"./request-DF8rRKj-.js";import{_ as C,r as v,o as T,c as z,d as u,e as n,f as k,l as g,t as r,i as y,F as R,g as F,h as c}from"./index-DEgG3K8i.js";const w={class:"page"},G={class:"content"},M={key:0,class:"my-card"},D=["src"],O={class:"info"},V={class:"name"},q={class:"sub"},x={class:"num"},B={class:"num"},J={class:"num"},X=["src"],L={class:"cell"},$={class:"title"},j={key:0,class:"me-tag"},U={class:"desc"},H={key:1,class:"empty"},K=["disabled"],P="https://img.yzcdn.cn/vant/user-active.png",Q={__name:"rank",setup(W){function _(t,s=0){return typeof t=="number"&&!Number.isNaN(t)?t:typeof t=="string"&&/^\d+$/.test(t)?Number(t):s}function p(t){var a;return((t==null?void 0:t.status)===200||(t==null?void 0:t.statusCode)===200)&&((a=t==null?void 0:t.data)==null?void 0:a.code)===0}function N(t,s=Number.MAX_SAFE_INTEGER){if(typeof t=="number")return t;if(typeof t=="string"&&/^\d+$/.test(t))return Number(t);const a=Date.parse(t);return Number.isNaN(a)?s:a}const d=v(!0),f=v([]),I=v("visitor");let i=null;T(async()=>{document.title="æ‰“å¡æ’å";try{const t=JSON.parse(localStorage.getItem("userInfo")||"{}");i=(t==null?void 0:t.id)??null}catch{}await b(),await h()});async function b(){var t,s,a,e;try{const o=await A("/auth/me","GET");if(p(o)){I.value=((s=(t=o.data)==null?void 0:t.userInfo)==null?void 0:s.role)||"visitor",i||(i=((e=(a=o.data)==null?void 0:a.userInfo)==null?void 0:e.id)??null);const m=JSON.parse(localStorage.getItem("userInfo")||"{}");localStorage.setItem("userInfo",JSON.stringify({...m,...o.data.userInfo}))}}catch{}}async function h(){var t;d.value=!0;try{const s=await A("/rank/list","GET");let a=p(s)&&Array.isArray((t=s.data)==null?void 0:t.list)?s.data.list:[];a=a.map(e=>{const o=_(e.unlocked,0),m=_(e.locking,0),S="count"in e?_(e.count,o+m):o+m;return{...e,userId:e.userId??e.id,avatar:e.avatar||P,unlocked:o,locking:m,count:S,createdAt:N(e.createdAt,Number.MAX_SAFE_INTEGER),updatedAt:N(e.updatedAt,Number.MAX_SAFE_INTEGER)}}),a.sort((e,o)=>o.count-e.count||e.updatedAt-o.updatedAt||e.createdAt-o.createdAt||String(e.username||"").localeCompare(String(o.username||""),"zh")),a=a.map((e,o)=>({...e,rank:o+1,rankClass:o===0?"first":o===1?"second":o===2?"third":"",me:!!(i&&e.userId===i)})),f.value=a}catch(s){console.error("[rank] fetch error",s),alert("åŠ è½½å¤±è´¥")}finally{d.value=!1}}const l=z(()=>f.value.find(t=>t.me));function E(t){return t===1?"ğŸ¥‡":t===2?"ğŸ¥ˆ":t===3?"ğŸ¥‰":String(t)}return(t,s)=>(c(),u("div",w,[s[5]||(s[5]=n("img",{class:"bg",src:"https://sysuzngcxy-1322240898.cos.ap-guangzhou.myqcloud.com/bg.jpg",alt:"bg"},null,-1)),s[6]||(s[6]=n("div",{class:"bg-mask"},null,-1)),s[7]||(s[7]=n("div",{class:"logo-container"},[n("img",{class:"logo-img",src:"https://sysuzngcxy-1322240898.cos.ap-guangzhou.myqcloud.com/logo1.png",alt:"logo"})],-1)),n("div",G,[l.value?(c(),u("div",M,[n("img",{class:"avatar lg",src:l.value.avatar,alt:"avatar"},null,8,D),n("div",O,[n("div",V,[g(r(l.value.username)+" ",1),s[0]||(s[0]=n("span",{class:"me-tag"},null,-1))]),n("div",q,[s[1]||(s[1]=g(" å·²è§£é” ",-1)),n("span",x,r(l.value.unlocked),1),s[2]||(s[2]=g(" Â· å®¡æ ¸ä¸­ ",-1)),n("span",B,r(l.value.locking),1),s[3]||(s[3]=g(" Â· æ€»è®¡ ",-1)),n("span",J,r(l.value.count),1)])]),n("div",{class:y(["chip",l.value.rankClass])},r(l.value.rank),3)])):k("",!0),s[4]||(s[4]=n("div",{class:"section-title"},"å…¨éƒ¨æ’å",-1)),(c(!0),u(R,null,F(f.value,a=>(c(),u("div",{key:a.userId??a.id??a.username,class:y(["row",[a.rankClass,a.me?"me":""]])},[n("div",{class:y(["rank",a.rankClass])},r(E(a.rank)),3),n("img",{class:"avatar",src:a.avatar,alt:"avatar"},null,8,X),n("div",L,[n("div",$,[g(r(a.username)+" ",1),a.me?(c(),u("span",j,"ï¼ˆæˆ‘ï¼‰")):k("",!0)]),n("div",U," å·²è§£é” "+r(a.unlocked)+" Â· å®¡æ ¸ä¸­ "+r(a.locking)+" Â· æ€»è®¡ "+r(a.count)+" Â· ",1)])],2))),128)),!d.value&&f.value.length===0?(c(),u("div",H,"æš‚æ— æ•°æ®")):k("",!0)]),n("button",{class:"refresh",disabled:d.value,onClick:h},r(d.value?"åŠ è½½ä¸­â€¦":"åˆ·æ–°"),9,K)]))}},tt=C(Q,[["__scopeId","data-v-d8bf56a7"]]);export{tt as default};
